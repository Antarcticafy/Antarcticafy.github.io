<input type="file" id="file-input">
<p>early wip it wont add a conditional to add more than 25 sounds, make sure it is minecraft compatable nbs file</p>
<p>check console for output in htsl</p>

<script src="https://cdn.jsdelivr.net/npm/@encode42/nbs.js"></script> <!-- Import NBS.js -->
<script>
  window.addEventListener("load", () => {
    const input = document.getElementById("file-input");

    // Clear the file input (QOL)
    input.value = null;

    // Initialize file input
    input.addEventListener("change", () => {
      const songFile = input.files[0]; // Read a NBS file
      songFile.arrayBuffer().then(buffer => { // Create an ArrayBuffer
        const song = NBSjs.fromArrayBuffer(buffer); // Parse song from ArrayBuffer

        let songNotes = [];
        let songNoteIndexes = [];
        let songNotePauses = [];
        let songNoteInstrument = [];
        const instrumentMapping = [
          "note.harp", "note.bass", "note.bd", "note.snare", "note.harp", "", "", "", "", "", "", "", "", "", "", "note.pling"
        ];

        console.log(song);

        song["layers"].forEach((element, index) => {
          element["notes"].forEach((element, index, array) => {
            songNoteIndexes.push(index + 1);
            songNotes.push((Math.round(10000000 * (2 ** (((element.key - 33) - 12) / 12)))) / 10000000);
            songNoteInstrument.push(element.instrument);
          });
          songNoteIndexes.forEach((element, index, array) => {
            if (index > 0) {
              songNotePauses.push((element - array[index - 1]) * (20 / song["tempo"]));
            }
          });
          const result = songNotes.map((value, index) => {
            const pauseValue = songNotePauses[index] || "5";
            const instrument = instrumentMapping[songNoteInstrument[index]];

            return `sound ${instrument} 0.7 ${value} "invokers_location"\npause ${pauseValue}`;
          }).join("\n");
          // console.log("//function" + index + "\n" + result);
          // chatgpt below
          // Your regular expression
          var regex = /^sound [^\s]+ 0\.7 \d+(\.\d+)? "invokers_location"$/gm;

          // Split the input string into lines
          var lines = result.split('\n');

          // Array to store chunks
          var chunks = [];
          var currentChunk = [];

          // Process each line separately, splitting after every 25th line that matches the regular expression
          for (var i = 0; i < lines.length; i++) {
            var line = lines[i];

            // Process the line using the regular expression
            var match = regex.exec(line);
            if (match !== null) {
              // Handle the match as needed
              currentChunk.push(line);

              // Split the string every 25 occurrences based on the regular expression
              if (currentChunk.length % 25 === 0) {
                chunks.push(currentChunk);
                currentChunk = [];
              }
            } else {
              // Include non-"sound" lines in the chunks
              currentChunk.push(line);
            }
          }

          // Output each chunk separately
          chunks.forEach(function (chunk, chunkindex) {
            console.log(`Function ${chunkindex + 1}-${index}:`);
            console.log(chunk.join('\n'));
          });

          //
          songNotes = [];
          songNoteIndexes = [];
          songNotePauses = [];
        });

      });
    });
  });
</script>