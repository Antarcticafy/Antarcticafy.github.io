<input type="file" id="file-input">
<p>early wip it wont add a conditional to add more than 25 sounds, make sure it is minecraft compatable nbs file</p>
<p>check console for output in htsl</p>

<script src="https://cdn.jsdelivr.net/npm/@encode42/nbs.js"></script> <!-- Import NBS.js -->
<script>
  window.addEventListener("load", () => {
    const input = document.getElementById("file-input");

    // Clear the file input (QOL)
    input.value = null;

    // Initialize file input
    input.addEventListener("change", () => {
      const songFile = input.files[0]; // Read a NBS file
      songFile.arrayBuffer().then(buffer => { // Create an ArrayBuffer
        const song = NBSjs.fromArrayBuffer(buffer); // Parse song from ArrayBuffer

        let songNotes = [];
        let songNoteIndexes = [];
        let songNotePauses = [];
        let songNoteInstrument = [];
        const instrumentMapping = [
          "note.harp", "note.bass", "note.bd", "note.snare", "note.harp", "", "", "", "", "", "", "", "", "", "", "note.pling"
        ];

        console.log(song);

        song["layers"].forEach(element => {
          element["notes"].forEach((element, index, array) => {
            songNoteIndexes.push(index + 1);
            songNotes.push((Math.round(10000000 * (2 ** (((element.key - 33) - 12) / 12)))) / 10000000);
            songNoteInstrument.push(element.instrument);
          });
          songNoteIndexes.forEach((element, index, array) => {
            if (index > 0) {
              songNotePauses.push((element - array[index - 1]) * (20 / song["tempo"]));
            }
          });
          const result = songNotes.map((value, index) => {
            const pauseValue = songNotePauses[index] || "5";
            const instrument = instrumentMapping[songNoteInstrument[index]];

            return `sound ${instrument} 0.7 ${value} "invokers_location"\npause ${pauseValue}`;
          }).join("\n");
          console.log(result);
          songNotes = [];
          songNoteIndexes = [];
          songNotePauses = [];
        });

      });
    });
  });
</script>
